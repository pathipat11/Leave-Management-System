{% extends "leave_app/base.html" %}
{% block title %}HR - Leave Dashboard{% endblock %}

{% block content %}
<h1 class="text-2xl font-semibold tracking-tight mb-2">
    HR Dashboard - คำขอลางานทั้งหมด
</h1>
<p class="mb-4 text-sm text-slate-500 dark:text-slate-400">
    ใช้ตัวกรองด้านล่างเพื่อค้นหาและส่งออกข้อมูลคำขอลางาน
</p>

<div class="flex flex-wrap items-center justify-between gap-2 mb-3">
    <div class="text-sm text-slate-500 dark:text-slate-400">
        ตัวกรองขั้นสูงสำหรับ HR
    </div>
    <div class="space-x-2 text-sm">
        <a href="{% url 'leave_app:hr_employee_create' %}"
           class="inline-flex items-center rounded-lg bg-emerald-600 px-3 py-2 font-medium text-white shadow
                  hover:bg-emerald-500 dark:bg-emerald-500 dark:hover:bg-emerald-400">
            + เพิ่มพนักงานใหม่
        </a>
        <a href="{% url 'leave_app:hr_employee_import' %}"
           class="inline-flex items-center rounded-lg bg-indigo-600 px-3 py-2 font-medium text-white shadow
                  hover:bg-indigo-500 dark:bg-indigo-500 dark:hover:bg-indigo-400">
            ⬆ นำเข้าพนักงานจาก Excel
        </a>
        <a href="{% url 'leave_app:hr_leave_balance_manage' %}"
           class="inline-flex items-center rounded-lg bg-orange-500 px-3 py-2 font-medium text-white shadow
                  hover:bg-orange-400 dark:hover:bg-orange-400">
            โควต้าวันลา
        </a>
    </div>
</div>

<form method="get"
      class="mb-4 rounded-2xl border border-slate-200 bg-white/90 p-4 shadow
             dark:border-slate-800 dark:bg-slate-900/70">

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
            <label class="block mb-1 text-sm font-medium">สถานะ</label>
            <select name="status" class="w-full rounded-lg border p-2">
                <option value="">-- ทั้งหมด --</option>
                {% for value, label in statuses %}
                <option value="{{ value }}" {% if filter_status == value %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
            </select>
        </div>

        <div>
            <label class="block mb-1 text-sm font-medium">แผนก</label>
            <select name="department" class="w-full rounded-lg border p-2">
                <option value="">-- ทั้งหมด --</option>
                {% for dept in departments %}
                <option value="{{ dept.id }}" {% if filter_department == dept.id|stringformat:"s" %}selected{% endif %}>
                    {{ dept.name }}
                </option>
                {% endfor %}
            </select>
        </div>

        <div>
            <label class="block mb-1 text-sm font-medium">ประเภทการลา</label>
            <select name="leave_type" class="w-full rounded-lg border p-2">
                <option value="">-- ทั้งหมด --</option>
                {% for lt in leave_types %}
                <option value="{{ lt.id }}" {% if filter_leave_type == lt.id|stringformat:"s" %}selected{% endif %}>
                    {{ lt.name }}
                </option>
                {% endfor %}
            </select>
        </div>
    </div>

    <div class="mt-4 flex gap-2">
        <button class="rounded-lg bg-blue-600 px-4 py-2 text-white hover:bg-blue-500">
            กรองข้อมูล
        </button>
        <a href="{% url 'leave_app:hr_leave_dashboard' %}"
           class="rounded-lg bg-slate-200 px-4 py-2 text-slate-700 hover:bg-slate-300">
            ล้างตัวกรอง
        </a>
    </div>
</form>

<table class="w-full rounded-2xl bg-white/90 shadow dark:bg-slate-900/70 text-sm overflow-hidden">
    <thead class="bg-slate-100 dark:bg-slate-800">
        <tr>
            <th class="px-3 py-2 text-left">วันที่ยื่น</th>
            <th class="px-3 text-left">พนักงาน</th>
            <th class="px-3 text-left">แผนก</th>
            <th class="px-3 text-left">ประเภท</th>
            <th class="px-3 text-left">ช่วงเวลา</th>
            <th class="px-3 text-left">สถานะ</th>
        </tr>
    </thead>
    <tbody>
        {% for leave in leaves %}
        <tr class="border-t dark:border-slate-700">
            <td class="px-3 py-2">{{ leave.created_at|date:"Y-m-d H:i" }}</td>
            <td class="px-3">{{ leave.employee.employee_code }}</td>
            <td class="px-3">{{ leave.employee.department.name|default:"-" }}</td>
            <td class="px-3">{{ leave.leave_type.name }}</td>
            <td class="px-3">{{ leave.start_date }} - {{ leave.end_date }}</td>
            <td class="px-3">{{ leave.get_status_display }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="6" class="py-4 text-center text-slate-500">ไม่มีข้อมูล</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
