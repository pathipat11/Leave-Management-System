{% extends "leave_app/base.html" %}
{% block title %}HR - Leave Dashboard{% endblock %}

{% block content %}
<h1 class="text-2xl font-semibold tracking-tight mb-2">
    HR Dashboard - คำขอลางานทั้งหมด
</h1>
<p class="mb-4 text-sm text-slate-500 dark:text-slate-400">
    ใช้ตัวกรองด้านล่างเพื่อค้นหาและส่งออกข้อมูลคำขอลางาน
</p>

<div class="flex flex-wrap items-center justify-between gap-2 mb-3">
    <div class="text-sm text-slate-500 dark:text-slate-400">
        มุมมองภาพรวมคำขอลางานทั้งบริษัท
    </div>
    <div class="space-x-2 text-sm">
        <a href="{% url 'leave_app:hr_employee_list' %}"
           class="inline-flex items-center rounded-lg bg-slate-700 px-3 py-2 font-medium text-white shadow
                  hover:bg-slate-600 dark:bg-slate-800 dark:hover:bg-slate-700">
            รายชื่อพนักงาน
        </a>
        <a href="{% url 'leave_app:hr_leave_balance_manage' %}"
           class="inline-flex items-center rounded-lg bg-orange-500 px-3 py-2 font-medium text-white shadow
                  hover:bg-orange-400 dark:hover:bg-orange-400">
            โควต้าวันลา
        </a>
    </div>
</div>

<form method="get"
      class="mb-4 rounded-2xl border border-slate-100 bg-white/80 p-4 text-sm shadow-sm
             dark:border-slate-800 dark:bg-slate-900/70">

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
            <label class="block mb-1 font-medium text-slate-700 dark:text-slate-200">สถานะ</label>
            <select name="status"
                    class="w-full rounded-lg border border-slate-200 bg-white/90 px-3 py-2 text-sm
                           focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400
                           dark:border-slate-700 dark:bg-slate-900/70 dark:text-slate-50">
                <option value="">-- ทั้งหมด --</option>
                {% for value, label in statuses %}
                <option value="{{ value }}" {% if filter_status == value %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
            </select>
        </div>

        <div>
            <label class="block mb-1 font-medium text-slate-700 dark:text-slate-200">แผนก</label>
            <select name="department"
                    class="w-full rounded-lg border border-slate-200 bg-white/90 px-3 py-2 text-sm
                           focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400
                           dark:border-slate-700 dark:bg-slate-900/70 dark:text-slate-50">
                <option value="">-- ทั้งหมด --</option>
                {% for dept in departments %}
                <option value="{{ dept.id }}" {% if filter_department == dept.id|stringformat:"s" %}selected{% endif %}>
                    {{ dept.name }}
                </option>
                {% endfor %}
            </select>
        </div>

        <div>
            <label class="block mb-1 font-medium text-slate-700 dark:text-slate-200">ประเภทการลา</label>
            <select name="leave_type"
                    class="w-full rounded-lg border border-slate-200 bg-white/90 px-3 py-2 text-sm
                           focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400
                           dark:border-slate-700 dark:bg-slate-900/70 dark:text-slate-50">
                <option value="">-- ทั้งหมด --</option>
                {% for lt in leave_types %}
                <option value="{{ lt.id }}" {% if filter_leave_type == lt.id|stringformat:"s" %}selected{% endif %}>
                    {{ lt.name }}
                </option>
                {% endfor %}
            </select>
        </div>
    </div>

    <div class="mt-4 flex flex-wrap gap-2">
        <button class="rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-500 dark:bg-blue-500 dark:hover:bg-blue-400">
            กรองข้อมูล
        </button>
        <a href="{% url 'leave_app:hr_leave_dashboard' %}"
           class="rounded-lg bg-slate-100 px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-200 dark:bg-slate-800 dark:text-slate-100 dark:hover:bg-slate-700">
            ล้างตัวกรอง
        </a>
    </div>
</form>

<table class="w-full rounded-2xl border border-slate-100 bg-white/80 shadow-sm text-sm overflow-hidden dark:border-slate-800 dark:bg-slate-900/70">
    <thead class="bg-slate-100 dark:bg-slate-800/70 dark:text-slate-100">
        <tr>
            <th class="px-3 py-2 text-left">วันที่ยื่น</th>
            <th class="px-3 text-left">พนักงาน</th>
            <th class="px-3 text-left">แผนก</th>
            <th class="px-3 text-left">ประเภท</th>
            <th class="px-3 text-left">ช่วงเวลา</th>
            <th class="px-3 text-left">สถานะ</th>
        </tr>
    </thead>
    <tbody>
        {% for leave in leaves %}
        <tr class="border-t border-slate-100 dark:border-slate-800">
            <td class="px-3 py-2">
                {{ leave.created_at|date:"Y-m-d H:i" }}
            </td>
            <td class="px-3">
                {{ leave.employee.employee_code }} -
                {{ leave.employee.user.get_full_name|default:leave.employee.user.username }}
            </td>
            <td class="px-3">
                {{ leave.employee.department.name|default:"-" }}
            </td>
            <td class="px-3">
                {{ leave.leave_type.name }}
            </td>
            <td class="px-3">
                {{ leave.start_date }} - {{ leave.end_date }}
                {% if leave.half_day %}(ครึ่งวัน){% endif %}
            </td>
            <td class="px-3">
                {{ leave.get_status_display }}
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="6" class="py-4 text-center text-slate-500 dark:text-slate-400">
                ไม่มีข้อมูลคำขอลางาน
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
